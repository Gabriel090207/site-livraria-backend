<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout</title>
  <link rel="shortcut icon" href="Nova-logo-rio-nilo-_3_.ico" type="image/x-icon">
  <link rel="stylesheet" href="checkout.css">


</head>

<body>

  <header>
    <div> <img class="logo" src="Nova logo rio nilo.png" alt="Livraria e Distribuidora Rio Nilo">
    </div>
  </header>

  <section>

    <h1>Checkout</h1>
    <div id="checkout-items"></div>
    <div class="total" id="checkout-total"></div>
    <div class="container_label">
      <label for="cpf" style="display: block; margin-bottom: 5px;">Digite seu CPF:</label>
      <input type="text" id="cpf" placeholder="000.000.000-00" style="padding: 8px; width: 200px;" />
      <p id="cpf-error"> CPF inválido. Por favor, preencha corretamente.</p>
    </div><br>
    <button id="confirm-btn">Finalizar Compra</button>
    <button id="confirm-btn" style="background-color: red; color:white;"><a href="loja.html"
        style="text-decoration: none; color:white;"> Cancelar comprar</a></button>

  </section>



  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cartKey = 'meuCarrinho';
      let cart = JSON.parse(localStorage.getItem(cartKey)) || [];

      const container = document.getElementById('checkout-items');
      const totalEl = document.getElementById('checkout-total');
      const confirmBtn = document.getElementById('confirm-btn');

      function renderCart() {
        container.innerHTML = '';
        let total = 0;

        if (cart.length === 0) {
          container.innerHTML = '<p>Seu carrinho está vazio.</p>';
          totalEl.textContent = '';
          confirmBtn.style.display = 'none';
          return;
        }

        cart.forEach((item, index) => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'cart-item';
          itemDiv.style.display = 'flex';
          itemDiv.style.alignItems = 'center';
          itemDiv.style.gap = '15px';
          itemDiv.style.marginBottom = '20px';

          const priceNumber = parseFloat(
            item.price.replace('R$', '').replace('.', '').replace(',', '.').trim()
          );
          total += isNaN(priceNumber) ? 0 : priceNumber;

          itemDiv.innerHTML = `
            <img src="${item.img}" alt="${item.name}" style="width: 70px; border: 1px solid #ccc;" />
            <div class="info" style="flex: 1;">
              <h3 style="margin: 0;">${item.name}</h3>
              <p style="margin: 5px 0;">${item.price}</p>
            </div>
            <button class="remove-btn" data-index="${index}" style="background-color: #e74c3c; color: white; border: none; padding: 8px 12px; cursor: pointer;">Remover</button>
          `;

          container.appendChild(itemDiv);
        });

        totalEl.textContent = `Total: R$ ${total.toFixed(2).replace('.', ',')}`;
        confirmBtn.style.display = 'block';

        document.querySelectorAll('.remove-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const indexToRemove = parseInt(e.target.getAttribute('data-index'));
            cart.splice(indexToRemove, 1);
            localStorage.setItem(cartKey, JSON.stringify(cart));
            renderCart(); // Atualiza a interface
          });
        });
      }

      renderCart();

      confirmBtn.addEventListener('click', () => {
        const cpfInput = document.getElementById('cpf');
        const cpfError = document.getElementById('cpf-error');
        const cpf = cpfInput.value.trim();

        if (!validarCPF(cpf)) {
          cpfError.style.display = 'block';
          return;
        } else {
          cpfError.style.display = 'none';
        }



        window.location.href = 'finalizar.html';
      });

      // Validador de CPF
      function validarCPF(cpf) {
        cpf = cpf.replace(/[^\d]+/g, '');
        if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;

        let soma = 0;
        for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i);
        let resto = (soma * 10) % 11;
        if (resto === 10 || resto === 11) resto = 0;
        if (resto !== parseInt(cpf.charAt(9))) return false;

        soma = 0;
        for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i);
        resto = (soma * 10) % 11;
        if (resto === 10 || resto === 11) resto = 0;
        if (resto !== parseInt(cpf.charAt(10))) return false;

        return true;
      }
    });
  </script>

  <script>
    // Menu lateral
    const menuIcon = document.querySelector('.menu-icon');
    const sideMenu = document.getElementById('side-menu');
    const closeMenu = document.getElementById('close-menu');

    menuIcon?.addEventListener('click', () => {
      sideMenu.classList.add('open');
    });

    closeMenu?.addEventListener('click', () => {
      sideMenu.classList.remove('open');
    });

    // Perfil do usuário
    const userIcon = document.getElementById('userIcon');
    const profileInfo = document.getElementById('profileInfo');

    userIcon?.addEventListener('click', () => {
      profileInfo.style.display = profileInfo.style.display === 'block' ? 'none' : 'block';
    });

    // Esconde o dropdown se clicar fora
    document.addEventListener('click', (e) => {
      if (!profileInfo.contains(e.target) && !userIcon.contains(e.target)) {
        profileInfo.style.display = 'none';
      }
    });
  </script>
</body>

</html>